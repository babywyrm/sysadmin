# Keycloak Misconfigurations 

| **Misconfiguration**                | **How to Implement**                                                                                  | **Exploit Scenario**                                                                                                                                              | **Mitigation in Real Life**                                                                                                  |
|-------------------------------------|-------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| **Weak Signing Algorithm**          | Set `alg` to `none` in **Realm Settings** → **Tokens**.                                               | Participants modify JWT payloads directly without needing to re-sign them.                                                                                       | Use strong algorithms like `RS256` or `HS256`. Disable `none` for token signatures.                                         |
| **Weak Secret Key**                 | Set a weak client secret (e.g., `supersecret`) in **Clients** → **Credentials**.                      | Participants forge valid JWTs using the leaked or guessable secret.                                                                                              | Use long, randomly generated secrets for clients. Rotate secrets regularly.                                                 |
| **Arbitrary Scope Injection**       | Enable **Full Scope Allowed** in **Clients** → **Scope**.                                             | Participants request tokens with unauthorized scopes (e.g., `admin`).                                                                                            | Validate token scopes explicitly in resource servers and disable "Full Scope Allowed" unless necessary.                     |
| **Improper Scope Validation**       | Skip verifying JWT signatures in your Warbird API or allow unverified tokens.                        | Participants add unauthorized scopes to the JWT payload to access restricted API endpoints.                                                                       | Always verify JWT signatures and validate claims (e.g., scopes, audience) in resource servers.                              |
| **Leaked Secrets via Other Challenges** | Expose realm secrets or weak signing keys in unrelated challenges (e.g., API responses or config files). | Participants piece together information from multiple CTF challenges to exploit the Keycloak and Warbird API integration.                                        | Restrict access to sensitive data. Avoid hardcoding or exposing secrets in logs, error messages, or configurations.          |
| **Excessive Token Lifetime**        | Set very long token expiration times (e.g., 24 hours or more) in **Realm Settings** → **Tokens**.     | Participants reuse tokens for extended periods, bypassing proper session control or token revocation processes.                                                  | Set short token expiration times and implement refresh tokens for long-lived sessions.                                       |
| **Public Clients with Excessive Privileges** | Configure a public client (no secret required) with access to sensitive scopes.                     | Participants can obtain access tokens for sensitive scopes without authenticating properly.                                                                      | Use confidential clients for sensitive operations. Limit permissions for public clients.                                     |
| **Misconfigured Audience Claim**    | Set a client to accept tokens issued for a different audience in **Clients** → **Advanced Settings**. | Participants use tokens intended for another client to access unauthorized resources.                                                                            | Verify audience (`aud`) claims in the resource server. Configure clients to validate tokens strictly.                        |
| **Unrestricted Token Exchange**     | Enable token exchange in **Clients** → **Advanced Settings** without proper validation.              | Participants exchange tokens to gain additional privileges or impersonate other users.                                                                           | Restrict token exchange and validate exchanged tokens carefully.                                                             |
| **Open Redirects in Login Endpoints** | Allow login redirect URIs to be overly permissive in **Clients** → **Settings**.                     | Participants craft malicious URLs to steal tokens or credentials via phishing.                                                                                   | Restrict redirect URIs to trusted domains. Avoid using wildcards in redirect URIs.                                           |
| **Insecure Communication**          | Use HTTP instead of HTTPS for Keycloak or your Warbird API.                                           | Participants intercept tokens and credentials in plaintext during transit via tools like Wireshark.                                                              | Enforce HTTPS for all communication. Use a secure TLS configuration with updated certificates.                               |

---

## Notes 

- These misconfigurations are designed for educational and controlled environments only.
- Ensure your production environments follow strict security practices and industry guidelines.
- Consider adding monitoring tools (e.g., logging and auditing) to detect potential exploit attempts in the CTF.


