# 🛡️ AWS Threat Hunting & APT Detection Matrix (Extended)



| Category                 | Threat Behavior / Indicator                                          | AWS Services                     | Sample Events / APIs                                      | Detection Strategy                                                                 | Splunk Query (Example)                                                                                                                                                      | Priority | Notes / Playbook Enrichment                                      |
|--------------------------|----------------------------------------------------------------------|----------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|--------------------------------------------------------------------|
| IAM Abuse & Priv Esc     | Role chaining or excessive privileges                               | IAM, STS                         | `AssumeRole`, `PassRole`, `AttachRolePolicy`              | Detect role usage outside normal identities                                      | `index=aws sourcetype=aws:cloudtrail eventName=AssumeRole | stats count by userIdentity.arn, requestParameters.roleArn, sourceIPAddress`                                                        | 🔴 High  | Monitor for lateral movement via assumed roles                  |
|                          | Creation of privileged users or keys                                | IAM                              | `CreateUser`, `CreateAccessKey`                           | Alert on unexpected IAM credential creation                                     | `index=aws sourcetype=aws:cloudtrail eventName IN ("CreateUser","CreateAccessKey") | stats count by userIdentity.arn, requestParameters.userName`                                 | 🔴 High  | Flag if not tied to CI/CD                                        |
|                          | Dormant key suddenly active                                          | IAM                              | `AccessKeyUsed`                                           | Detect old key reuse — possible sleeper creds                                  | `index=aws sourcetype=aws:cloudtrail eventName=AccessKeyUsed | transaction userIdentity.accessKeyId maxspan=30d | search duration > 2592000`                                      | 🟠 Med   | Overlay with asset age & ownership                              |
| Network & Perimeter      | Suspicious outbound traffic or beaconing                            | VPC, Flow Logs                   | VPC Flow Logs                                             | Monitor for unknown egress or TOR/VPN traffic                                 | `index=vpcflow sourcetype=aws:cloudwatchlogs:vpcflow direction=EGRESS action=ACCEPT | stats count by dstaddr, dstport | where dstaddr!=<internal ranges>`                         | 🔴 High  | Match against threat intel / TOR lists                          |
|                          | New VPC endpoints to sensitive services                             | EC2, VPC                         | `CreateVpcEndpoint`                                       | Detect covert channel potential                                                 | `index=aws sourcetype=aws:cloudtrail eventName=CreateVpcEndpoint | stats count by userIdentity.arn, requestParameters.serviceName`                              | 🟠 Med   | Watch for endpoints to SecretsManager, SSM, Lambda              |
|                          | Open security groups or NAT gateway additions                       | EC2, VPC                         | `AuthorizeSecurityGroupIngress`, `CreateNatGateway`       | Catch perimeter misconfig or exfil setup                                        | `index=aws sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress","CreateNatGateway") | stats count by sourceIPAddress`                         | 🔴 High  | Watch for wide open ports (22/3389/0.0.0.0)                      |
| Data Exfil / Access      | Unusual download of secrets, S3, RDS, etc.                          | S3, SecretsMgr, RDS              | `GetObject`, `GetSecretValue`, `DownloadDBLogFilePortion` | Detect bulk read or off-hours access                                            | `index=aws sourcetype=aws:cloudtrail eventName IN ("GetObject","GetSecretValue") | stats count by userIdentity.arn, sourceIPAddress`                                          | 🔴 High  | Correlate with time & data sensitivity                          |
|                          | Snapshot copy or sharing                                            | EC2                              | `CreateSnapshot`, `CopySnapshot`, `ModifySnapshotAttribute`| Detect exfil via EBS snapshot copying                                           | `index=aws sourcetype=aws:cloudtrail eventName IN ("CopySnapshot","ModifySnapshotAttribute")`                                         | 🔴 High  | Look for cross-region or public sharing                         |
| Compute Abuse            | Rogue EC2 or Lambda deployed                                        | EC2, Lambda                      | `RunInstances`, `CreateFunction`                          | Alert on compute resources from non-CI users                                   | `index=aws sourcetype=aws:cloudtrail eventName IN ("RunInstances","CreateFunction") | stats count by userIdentity.arn, awsRegion`            | 🔴 High  | Check AMI, user-data, region anomalies                          |
|                          | Use of EC2 Connect or SSM for backdoor                              | EC2, SSM                         | `SendCommand`, `StartSession`, `SendSSHPublicKey`         | Identify backdoor or stealth access                                             | `index=aws sourcetype=aws:cloudtrail eventName IN ("SendCommand","StartSession") | stats count by sourceIPAddress, userIdentity.arn`               | 🟠 Med   | Correlate with known SSM entrypoints                            |
| Detection Evasion        | CloudTrail, GuardDuty, Config tampering                            | CloudTrail, GuardDuty, Config    | `StopLogging`, `DeleteTrail`, `DisableSecurityHub`         | Monitor for any log/system modification attempt                                 | `index=aws sourcetype=aws:cloudtrail eventName IN ("StopLogging","DisableGuardDuty","UpdateTrail")`                                    | 🔴 High  | Any match should be considered high severity                    |
| Reconnaissance           | Enumeration of services or roles                                    | IAM, EC2, S3                     | `ListRoles`, `DescribeInstances`, `ListBuckets`           | Alert on excessive List*/Describe* from same source                            | `index=aws sourcetype=aws:cloudtrail eventName IN ("ListRoles","DescribeInstances","ListBuckets") | stats count by userIdentity.arn`                     | 🟠 Med   | Flag by volume or odd actor                                     |
| Persistence Mechanisms   | Modification of IAM trust policies                                  | IAM                              | `UpdateAssumeRolePolicy`                                  | Detect when a role's trust relationship is changed                             | `index=aws sourcetype=aws:cloudtrail eventName=UpdateAssumeRolePolicy | stats count by requestParameters.policyDocument`                 | 🔴 High  | Map to roles with privilege or CI/CD trust                     |
|                          | Malicious EventBridge or Lambda triggers                            | Lambda, EventBridge              | `PutRule`, `PutTargets`, `AddPermission`                  | Detect persistent backdoor triggers                                             | `index=aws sourcetype=aws:cloudtrail eventName IN ("PutRule","PutTargets") | stats count by userIdentity.arn`                                | 🟠 Med   | Watch for event-driven backdoors                               |
| Time & Region Anomalies  | Access from new country or odd hour                                 | IAM                              | `ConsoleLogin`, `AssumeRole`                              | Alert on geolocation or time-of-day anomalies                                  | `index=aws sourcetype=aws:cloudtrail eventName=ConsoleLogin | lookup geolocation | where login_time < 6AM OR country!=US`                          | 🟠 Med   | Tune for org timezone and remote access policies               |
| Cross-Account Movement   | Assumed roles across linked accounts                                | STS                              | `AssumeRole`                                               | Detect role assumption outside expected boundaries                              | `index=aws sourcetype=aws:cloudtrail eventName=AssumeRole | stats by awsAccountId, userIdentity.arn`                         | 🔴 High  | Visualize with org-wide STS maps                               |
| Service Misuse           | StepFunctions, EventBridge, or SecretsManager misused               | StepFunctions, SecretsMgr        | `StartExecution`, `GetSecretValue`                         | Look for automation services used for persistence or covert ops                 | `index=aws sourcetype=aws:cloudtrail eventName IN ("StartExecution","GetSecretValue") | stats by userIdentity.arn`                            | 🟠 Med   | Good to correlate with usage patterns                           |
